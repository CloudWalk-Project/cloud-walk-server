generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Canva {
  id           Int           @id() @default(autoincrement())
  name         String        @db.VarChar(30)
  price        Float
  sku          String        @db.VarChar(255)
  genre        Bytes
  description  String?       @db.VarChar(300)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  category     Category      @relation(fields: [categoryName], references: [name], onDelete: Cascade, onUpdate: Cascade)
  categoryName String        @db.VarChar(255)
  product      Product[]
  updateCanva  UpdateCanva[]
  @@map("canvas")
}

model Cart {
  id            Int       @id() @default(autoincrement())
  quantity      Int?
  priceSum      Float?
  finalPrice    Float
  totalDiscount Float
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  customer      Customer  @relation(fields: [costumerId], references: [id], onDelete: NoAction, onUpdate: Cascade)
  costumerId    Int
  voucher       Voucher?  @relation(fields: [voucherId], references: [id], onDelete: NoAction, onUpdate: Cascade)
  voucherId     Int?
  product       Product[]
  @@map("carts")
}

model Category {
  id          Int      @id() @default(autoincrement())
  price       Float
  name        String   @unique @db.VarChar(255)
  description String?  @db.VarChar(300)
  cost        Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  canvas       Canva[]
  @@map("categories")
}

model Customer {
  id        Int      @id() @default(autoincrement())
  name      String   @db.VarChar(25)
  password  String   @db.VarChar(15)
  email     String   @unique @db.VarChar(50)
  wallet    Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  carts     Cart[]
  @@map("customers")
}

model Guideline {
  id            Int      @id() @default(autoincrement())
  aboutUs       String   @db.VarChar(500)
  privacyPolicy String?  @db.VarChar(500)
  refundPolicy  String   @db.VarChar(500)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  @@map("guidelines")
}

model Product {
  id        Int      @id() @default(autoincrement())
  erased    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: NoAction, onUpdate: Cascade)
  cartId    Int
  canva     Canva?   @relation(fields: [canvaId], references: [id], onDelete: NoAction, onUpdate: Cascade)
  canvaId   Int?
  @@map("products")
}

model UpdateCanva {
  id        Int      @id() @default(autoincrement())
  oldPrice  Float
  newPrice  Float
  createdAt DateTime @default(now()) 
  user      User     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: Cascade, map: "updateCanva_fk0")
  userId    Int
  canva     Canva    @relation(fields: [canvaId], references: [id], onDelete: NoAction, onUpdate: Cascade, map: "updateCanva_fk1")
  canvaId   Int
  @@map("updated_canvas")
}

model User {
  id          Int           @id() @default(autoincrement())
  name        String        @db.VarChar(25)
  image       String?       @db.VarChar(255)
  password    String        @db.VarChar(15)
  email       String        @unique @db.VarChar(50)
  role        UserRole      @default(SalesPerson)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  updateCanva UpdateCanva[]
  @@map("users")
}

model Voucher {
  id           Int       @id() @default(autoincrement())
  discountRate Float
  active       Boolean   @default(false)
  startDate    DateTime? @db.Date
  maxQuantity  Int?
  interval     Int
  endDate      DateTime? @db.Date
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  cart         Cart[]
  @@map("vouchers")
}

enum UserRole {
  Owner
  Manager
  SalesPerson
}
